name: NBA daily retry on scheduled failure

on:
  workflow_run:
    workflows: ["NBA daily box scores"]
    types:
      - completed

jobs:
  retry:
    if: >
      github.event.workflow_run.conclusion == 'failure' &&
      github.event.workflow_run.event == 'schedule'
    runs-on: ubuntu-latest
    steps:
      - name: Wait 5 hours before retry
        run: |
          echo "‚è≥ Waiting 5 hours before retry (in 30-min increments)..."
          for i in $(seq 1 10); do
            echo "  Sleeping chunk $i/10 (30 min)..."
            sleep 1800
          done
          echo "‚úÖ Wait complete"

      - name: Retry failed workflow
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          RUN_ID=${{ github.event.workflow_run.id }}
          echo "üîÅ Re-running workflow run $RUN_ID"
          gh run rerun "$RUN_ID" --repo "${{ github.repository }}"
